services:
  devenv:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: dotfiles-dev:latest
    container_name: dotfiles-dev
    volumes:
      # Persist Nix store for faster rebuilds
      - nix-store:/nix
      # Persist cargo/rustup data
      - cargo-home:/home/dev/.cargo
      - rustup-home:/home/dev/.rustup
      # Persist home directory data
      - home-data:/home/dev/.local
      - home-cache:/home/dev/.cache
    working_dir: /home/dev
    stdin_open: true
    tty: true
    environment:
      - TERM=xterm-256color
      - COLORTERM=truecolor
    command: /home/dev/.nix-profile/bin/zsh

volumes:
  nix-store:
    driver: local
  cargo-home:
    driver: local
  rustup-home:
    driver: local
  home-data:
    driver: local
  home-cache:
    driver: local
